"use strict";(self.webpackChunkiobroker_admin_component_telegram=self.webpackChunkiobroker_admin_component_telegram||[]).push([["src_Components_jsx"],{79285:function(_,f,i){i.r(f),i.d(f,{default:function(){return M}});var y=i(4819),t=i.n(y),C=i(15854),r=i.n(C),E=i(58503),a=i(94427),b=i(59665),c=i(75606),T=Object.defineProperty,S=(o,e,s)=>e in o?T(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s,x=(o,e,s)=>(S(o,typeof e!="symbol"?e+"":e,s),s),g=(o,e,s)=>new Promise((n,l)=>{var m=d=>{try{h(s.next(d))}catch(p){l(p)}},u=d=>{try{h(s.throw(d))}catch(p){l(p)}},h=d=>d.done?n(d.value):Promise.resolve(d.value).then(m,u);h((s=s.apply(o,e)).next())});const N=()=>({table:{minWidth:400},header:{fontSize:16,fontWeight:"bold"}});class v extends c.ConfigGeneric{constructor(e){super(e),x(this,"onAliveChanged",(s,n)=>{const l=n?n.val:!1;l!==this.state.alive&&this.setState({alive:l},()=>{l&&!this.state.initialized&&this.readData()})}),this.state={alive:!1,initialized:!1,users:[],confirm:null}}componentDidMount(){super.componentDidMount(),this.props.socket.getState(`system.adapter.telegram.${this.props.instance}.alive`).then(e=>g(this,null,function*(){e&&e.val?this.setState({alive:!0},()=>this.readData()):this.setState({alive:!1}),yield this.props.socket.subscribeState(`system.adapter.telegram.${this.props.instance}.alive`,this.onAliveChanged)}))}readData(){this.props.socket.sendTo(`telegram.${this.props.instance}`,"adminuser",null).then(e=>{const s=[];for(const n in e){const l=[];e[n].userName&&l.push(e[n].userName),e[n].firstName&&l.push(e[n].firstName),s.push({id:n,names:l.join(" / "),sysMessages:e[n].sysMessages})}this.setState({users:s,initialized:!0})})}componentWillUnmount(){return g(this,null,function*(){yield this.props.socket.unsubscribeState(`system.adapter.telegram.${this.props.instance}.alive`,this.onAliveChanged)})}onSysMessageChange(e){const s=this.state.users.findIndex(n=>n.id===e);if(s!==-1){const n=!this.state.users[s].sysMessages;this.props.socket.sendTo(`telegram.${this.props.instance}`,"systemMessages",{itemId:e,checked:n}).then(l=>{if(l===e){const m=JSON.parse(JSON.stringify(this.state.users)),u=m.findIndex(h=>h.id===e);u!==-1&&(m[u].sysMessages=n,this.setState({users:m}))}})}}onDelete(e){this.props.socket.sendTo(`telegram.${this.props.instance}`,"delUser",e).then(s=>{if(s===e){const n=JSON.parse(JSON.stringify(this.state.users)),l=n.findIndex(m=>m.id===e);l!==-1&&(n.splice(l,1),this.setState({users:n}))}})}renderConfirmDialog(){return this.state.confirm?t().createElement(c.Confirm,{onClose:e=>{const s=this.state.confirm;this.setState({confirm:null},()=>e&&this.onDelete(s))}}):null}renderItem(){return!this.state.alive&&!this.state.initialized?t().createElement("div",null,c.i18n.t("custom_telegram_not_alive")):this.state.initialized?t().createElement("div",{style:{width:"100%"}},t().createElement("h4",null,c.i18n.t("custom_telegram_title")),t().createElement(a.TableContainer,{component:a.Paper,style:{width:"100%"}},t().createElement(a.Table,{style:{width:"100%"},size:"small"},t().createElement(a.TableHead,null,t().createElement(a.TableRow,null,t().createElement(a.TableCell,null,c.i18n.t("custom_telegram_id")),t().createElement(a.TableCell,null,c.i18n.t("custom_telegram_name")),t().createElement(a.TableCell,null,c.i18n.t("custom_telegram_sys_messages")),t().createElement(a.TableCell,null))),t().createElement(a.TableBody,null,this.state.users.map(e=>t().createElement(a.TableRow,{key:e.id,sx:{"&:last-child td, &:last-child th":{border:0}}},t().createElement(a.TableCell,{component:"th",scope:"row"},e.id),t().createElement(a.TableCell,null,e.names),t().createElement(a.TableCell,null,t().createElement(a.Checkbox,{disabled:!this.state.alive,checked:!!e.sysMessages,onClick:()=>this.onSysMessageChange(e.id)})),t().createElement(a.TableCell,null,t().createElement(a.IconButton,{disabled:!this.state.alive,onClick:()=>this.setState({confirm:e.id})},t().createElement(b.Delete,null)))))))),this.renderConfirmDialog()):t().createElement(a.LinearProgress,null)}}v.propTypes={socket:r().object.isRequired,themeType:r().string,themeName:r().string,style:r().object,className:r().string,data:r().object.isRequired,attr:r().string,schema:r().object,onError:r().func,onChange:r().func};var D=(0,E.withStyles)(N)(v),M={TelegramComponent:D}}}]);

//# sourceMappingURL=src_Components_jsx.162d0d69.chunk.js.map