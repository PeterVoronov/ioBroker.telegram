"use strict";(self.webpackChunkiobroker_admin_component_telegram=self.webpackChunkiobroker_admin_component_telegram||[]).push([["src_Components_jsx"],{92094:(D,f,i)=>{i.r(f),i.d(f,{default:()=>I});var C=i(28437),t=i.n(C),y=i(95973),r=i.n(y),a=i(67085),E=i(21839),d=i(37449),T=i(60556),b=Object.defineProperty,S=(o,e,s)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s,x=(o,e,s)=>(S(o,typeof e!="symbol"?e+"":e,s),s),g=(o,e,s)=>new Promise((n,l)=>{var c=m=>{try{h(s.next(m))}catch(p){l(p)}},u=m=>{try{h(s.throw(m))}catch(p){l(p)}},h=m=>m.done?n(m.value):Promise.resolve(m.value).then(c,u);h((s=s.apply(o,e)).next())});class v extends T.ConfigGeneric{constructor(e){super(e),x(this,"onAliveChanged",(s,n)=>{const l=n?n.val:!1;l!==this.state.alive&&this.setState({alive:l},()=>{l&&!this.state.initialized&&this.readData()})}),this.state={alive:!1,initialized:!1,users:[],confirm:null}}componentDidMount(){super.componentDidMount(),this.props.socket.getState(`system.adapter.telegram.${this.props.instance}.alive`).then(e=>g(this,null,function*(){e&&e.val?this.setState({alive:!0},()=>this.readData()):this.setState({alive:!1}),yield this.props.socket.subscribeState(`system.adapter.telegram.${this.props.instance}.alive`,this.onAliveChanged)}))}readData(){this.props.socket.sendTo(`telegram.${this.props.instance}`,"adminuser",null).then(e=>{const s=[];for(const n in e){const l=[];e[n].userName&&l.push(e[n].userName),e[n].firstName&&l.push(e[n].firstName),s.push({id:n,names:l.join(" / "),sysMessages:e[n].sysMessages})}this.setState({users:s,initialized:!0})})}componentWillUnmount(){return g(this,null,function*(){yield this.props.socket.unsubscribeState(`system.adapter.telegram.${this.props.instance}.alive`,this.onAliveChanged)})}onSysMessageChange(e){const s=this.state.users.findIndex(n=>n.id===e);if(s!==-1){const n=!this.state.users[s].sysMessages;this.props.socket.sendTo(`telegram.${this.props.instance}`,"systemMessages",{itemId:e,checked:n}).then(l=>{if(l===e){const c=JSON.parse(JSON.stringify(this.state.users)),u=c.findIndex(h=>h.id===e);u!==-1&&(c[u].sysMessages=n,this.setState({users:c}))}})}}onDelete(e){this.props.socket.sendTo(`telegram.${this.props.instance}`,"delUser",e).then(s=>{if(s===e){const n=JSON.parse(JSON.stringify(this.state.users)),l=n.findIndex(c=>c.id===e);l!==-1&&(n.splice(l,1),this.setState({users:n}))}})}renderConfirmDialog(){return this.state.confirm?t().createElement(d.Confirm,{onClose:e=>{const s=this.state.confirm;this.setState({confirm:null},()=>e&&this.onDelete(s))}}):null}renderItem(){return!this.state.alive&&!this.state.initialized?t().createElement("div",null,d.I18n.t("custom_telegram_not_alive")):this.state.initialized?t().createElement("div",{style:{width:"100%"}},t().createElement("h4",null,d.I18n.t("custom_telegram_title")),t().createElement(a.TableContainer,{component:a.Paper,style:{width:"100%"}},t().createElement(a.Table,{style:{width:"100%"},size:"small"},t().createElement(a.TableHead,null,t().createElement(a.TableRow,null,t().createElement(a.TableCell,null,d.I18n.t("custom_telegram_id")),t().createElement(a.TableCell,null,d.I18n.t("custom_telegram_name")),t().createElement(a.TableCell,null,d.I18n.t("custom_telegram_sys_messages")),t().createElement(a.TableCell,null))),t().createElement(a.TableBody,null,this.state.users.map(e=>t().createElement(a.TableRow,{key:e.id,sx:{"&:last-child td, &:last-child th":{border:0}}},t().createElement(a.TableCell,{component:"th",scope:"row"},e.id),t().createElement(a.TableCell,null,e.names),t().createElement(a.TableCell,null,t().createElement(a.Checkbox,{disabled:!this.state.alive,checked:!!e.sysMessages,onClick:()=>this.onSysMessageChange(e.id)})),t().createElement(a.TableCell,null,t().createElement(a.IconButton,{disabled:!this.state.alive,onClick:()=>this.setState({confirm:e.id})},t().createElement(E.Delete,null)))))))),this.renderConfirmDialog()):t().createElement(a.LinearProgress,null)}}v.propTypes={socket:r().object.isRequired,themeType:r().string,themeName:r().string,style:r().object,data:r().object.isRequired,attr:r().string,schema:r().object,onError:r().func,onChange:r().func};const I={TelegramComponent:v}}}]);

//# sourceMappingURL=src_Components_jsx.3f7d60eb.chunk.js.map