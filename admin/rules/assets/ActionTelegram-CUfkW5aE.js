import{i as o,A as d}from"./ActionTelegram__mf_v__runtimeInit__mf_v__-mOGARPzg.js";import"./preload-helper-D6kgxu3v.js";let c=class{};const{loadShare:u}=o,{initPromise:m}=d,_=m.then(n=>u("@iobroker/adapter-react-v5",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),h=await _.then(n=>n());var g=h;const i=window.GenericBlock||c;class l extends i{cachePromises;constructor(e){super(e,l.getStaticData()),this.cachePromises={}}static compile(e,t){let a=(e.text||"").replace(/"/g,'\\"');return a?`// Telegram ${a||""}
		const subActionVar${e._id} = "${(a||"").replace(/"/g,'\\"')}"${i.getReplacesInText(t)};
		_sendToFrontEnd(${e._id}, {text: subActionVar${e._id}});
		sendTo("${e.instance}", "send", ${e.user&&e.user!=="_"?`{user: "${(e.user||"").replace(/"/g,'\\"')}", text: subActionVar${e._id}}`:`subActionVar${e._id}`});`:`// no text defined
_sendToFrontEnd(${e._id}, {text: 'No text defined'});`}renderDebug(e){return`${g.I18n.t("Sent:")} ${e.data.text}`}onValueChanged(e,t){t==="instance"&&this._setUsers(e)}_setUsers(e){if(e=e||this.state.settings.instance||"telegram.0",this.cachePromises[e]=this.cachePromises[e]||this.props.socket.getState(`${e}.communicate.users`),!this.state.settings._id)return this.setState({inputs:[{nameRender:"renderSelect",adapter:"telegram",frontText:"Instance:",defaultValue:"telegram.0",attr:"instance"},{nameRender:"renderSelect",attr:"user",options:[{title:"telegram.0",value:"telegram.0"}],defaultValue:"",frontText:"User:"},{nameRender:"renderModalInput",attr:"text",defaultValue:"Hallo",nameBlock:"",frontText:"Text:"}]},()=>super.onTagChange());this.cachePromises[e].then(t=>{let a;try{const r=t!=null&&t.val?JSON.parse(t.val):null;a=r?Object.keys(r).map(s=>({title:r[s].userName||r[s].firstName,value:s})):[],a.unshift({title:"all1",value:""})}catch{a=[{title:"all1",value:""}]}this.setState({inputs:[{nameRender:"renderInstance",adapter:"telegram",frontText:"Instance:",defaultValue:"telegram.0",attr:"instance"},{nameRender:"renderSelect",attr:"user",options:a,defaultValue:"_",frontText:"User:"},{nameRender:"renderModalInput",attr:"text",defaultValue:"Hallo",nameBlock:"",frontText:"Text:"}]},()=>super.onTagChange())})}onTagChange(e){this._setUsers()}static getStaticData(){return{acceptedBy:"actions",name:"Telegram",id:"ActionTelegram",adapter:"telegram",title:"Sends message via telegram",helpDialog:"You can use %s in the text to display current trigger value or %id to display the triggered object ID"}}getData(){return l.getStaticData()}}export{l as default};
